<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>POS Web App — HTML with Login, Discounts & Cash</title>
  <style>
    :root{--bg:#f7fafc;--card:#ffffff;--accent:#2563eb;--muted:#6b7280}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:16px;display:grid;grid-template-columns:1fr 420px;gap:20px}
    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
    h1{margin:0;font-size:20px}
    .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .product{border:1px solid #e6edf6;border-radius:8px;padding:10px;display:flex;flex-direction:column}
    .product .meta{font-size:13px;color:var(--muted)}
    .product button{margin-top:10px;padding:8px;border-radius:6px;background:var(--accent);color:#fff;border:0;cursor:pointer}
    .cart-list{max-height:300px;overflow:auto}
    .cart-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #eee;cursor:pointer}
    .muted{color:var(--muted)}
    .btn{display:inline-block;padding:8px 12px;border-radius:6px;border:0;background:#111;color:#fff;cursor:pointer}
    .btn.secondary{background:#f3f4f6;color:#111}
    .transactions{margin-top:14px}
    footer{max-width:1100px;margin:18px auto;text-align:center;color:var(--muted);font-size:13px}
    .login-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
    .keypad{display:grid;grid-template-columns:repeat(3,60px);gap:8px;margin-top:12px}
    .keypad button{padding:14px;font-size:18px;border-radius:6px;border:1px solid #ccc;background:#f9fafb;cursor:pointer}
    .discounts{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
    .cart-item.selected{background:#e0f2fe}
    .cash-input{display:flex;gap:6px;align-items:center;margin-top:6px}
    .self-checkout .btn.cash{display:none}
    @media (max-width:900px){.container{grid-template-columns:1fr;}.header{flex-direction:column;align-items:flex-start;gap:8px}}
  </style>
</head>
<body>
<div id="loginScreen" class="login-screen">
<h2>Login</h2>
<input id="loginId" placeholder="Employee ID" style="padding:8px;margin:6px;width:200px" />
<input id="loginPin" placeholder="PIN" type="password" style="padding:8px;margin:6px;width:200px" />
<div class="keypad" id="keypad"></div>
<button id="loginBtn" class="btn" style="margin-top:12px">Login</button>
<div id="loginMsg" class="muted" style="margin-top:8px"></div>
</div>

<div id="app" style="display:none">
<div class="header container">
  <div>
    <h1>POS Web App</h1>
    <div id="userRole" class="muted">Logged in as: </div>
  </div>
  <div style="display:flex;gap:8px;align-items:center">
    <button id="exportProducts" class="btn secondary">Export Products CSV</button>
    <button id="exportSales" class="btn secondary">Export Sales CSV</button>
    <button id="toggleSelfCheckout" class="btn secondary">Toggle Self-Checkout</button>
  </div>
</div>

<main class="container">
<section>
<div class="card">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
<strong>Products</strong>
<input id="search" placeholder="Search products or SKU" style="padding:8px;border-radius:6px;border:1px solid #e5e7eb;width:280px" />
</div>
<div id="products" class="products"></div>
</div>
<div id="transactions" class="card transactions" style="margin-top:12px">
<strong>Transactions</strong>
<div id="txList" style="margin-top:8px"></div>
</div>
</section>

<aside>
<div class="card" id="cartCard">
<strong>Cart</strong>
<div id="cartList" class="cart-list" style="margin-top:10px"></div>
<div class="discounts">
<button id="discount10" class="btn secondary">10% Off</button>
<button id="discount20" class="btn secondary">20% Off</button>
<button id="employeeDiscount" class="btn secondary">Employee 30% Off Total</button>
</div>
<div style="margin-top:12px;border-top:1px dashed #eee;padding-top:10px">
<div style="display:flex;justify-content:space-between"><div class="muted">Subtotal</div><div id="subtotal">$0.00</div></div>
<div style="display:flex;justify-content:space-between"><div class="muted">Tax</div><div id="tax">$0.00</div></div>
<div style="display:flex;justify-content:space-between;font-weight:600;margin-top:6px"><div>Total</div><div id="total">$0.00</div></div>
<div class="cash-input" id="cashInputDiv">
<input type="number" id="cashReceived" placeholder="Cash Received" style="padding:6px;flex:1" />
<button id="addBill" class="btn secondary">+Bill</button>
<button id="subtractBill" class="btn secondary">-Bill</button>
<div id="changeDue" style="margin-left:8px;font-weight:600">Change: $0.00</div>
</div>
<div style="margin-top:12px;display:flex;gap:8px">
<button id="payCash" class="btn cash" style="flex:1">Pay Cash</button>
<button id="payCard" class="btn" style="flex:1">Pay Card</button>
</div>
<button id="clearCart" class="btn secondary" style="width:100%;margin-top:8px">Clear Cart</button>
</div>
</aside>
</main>

<footer>Works offline. Data stored locally. Export CSV to back up.</footer>

<script>
const users={"1001":{pin:"522684773",role:"Manager"},"1002":{pin:"05172013",role:"Employee"},"1003":{pin:"11223344",role:"Employee"}};
let currentUser=null;
const loginScreen=document.getElementById('loginScreen');
const app=document.getElementById('app');
const loginBtn=document.getElementById('loginBtn');
const loginId=document.getElementById('loginId');
const loginPin=document.getElementById('loginPin');
const loginMsg=document.getElementById('loginMsg');
const userRoleEl=document.getElementById('userRole');
const keypad=document.getElementById('keypad');
[1,2,3,4,5,6,7,8,9,0].forEach(num=>{const btn=document.createElement('button');btn.textContent=num;btn.addEventListener('click',()=>{loginPin.value+=num});keypad.appendChild(btn);});
loginBtn.addEventListener('click',()=>{const id=loginId.value.trim();const pin=loginPin.value.trim();if(users[id]&&users[id].pin===pin){currentUser={id,role:users[id].role};loginScreen.style.display='none';app.style.display='block';userRoleEl.textContent='Logged in as: '+currentUser.role;}else{loginMsg.textContent='Invalid ID or PIN';}});

// --- Data & persistence ---
const defaultProducts=[{id:'p1',sku:'1001',name:'Coffee',price:3,qty:50,type:'food'},{id:'p2',sku:'1002',name:'Sandwich',price:5,qty:30,type:'food'},{id:'p3',sku:'1003',name:'Cake',price:4,qty:20,type:'food'},{id:'p4',sku:'1004',name:'Juice',price:2,qty:60,type:'other'}];
let products=load('pos_products')||defaultProducts;
let cart=load('pos_cart')||[];
let sales=load('pos_sales')||[];
let selectedCartIndex=null;
let employeeDiscountActive=false;
let selfCheckoutMode=false;
const TAX_RATES={food:0.14,other:0.255};

const productsEl=document.getElementById('products');
const cartList=document.getElementById('cartList');
const subtotalEl=document.getElementById('subtotal');
const taxEl=document.getElementById('tax');
const totalEl=document.getElementById('total');
const txList=document.getElementById('txList');
const search=document.getElementById('search');
const cashReceived=document.getElementById('cashReceived');
const changeDue=document.getElementById('changeDue');
const cashInputDiv=document.getElementById('cashInputDiv');
const payCash=document.getElementById('payCash');

function save(key,val){localStorage.setItem(key,JSON.stringify(val));}
function load(key){try{return JSON.parse(localStorage.getItem(key));}catch(e){return null}}
function fmt(n){return '$'+Number(n).toFixed(2);}

function renderProducts(filter=''){
productsEl.innerHTML='';
const q=filter.trim().toLowerCase();
products.filter(p=>!q||p.name.toLowerCase().includes(q)||p.sku.toLowerCase().includes(q)).forEach(p=>{
const el=document.createElement('div');el.className='product';
el.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${escapeHtml(p.name)}</strong><div class='meta'>SKU ${p.sku} • ${p.qty} in stock</div></div><div style='text-align:right'><div style='font-weight:600;margin-bottom:6px'>${fmt(p.price)}</div><button data-id='${p.id}'>Add</button></div></div>`;
el.querySelector('button').addEventListener('click',()=>addToCart(p.id,1));
productsEl.appendChild(el);
});
}

function renderCart(){
cartList.innerHTML='';
let subtotal=0;
let totalTax=0;
cart.forEach((c,idx)=>{
const taxRate=TAX_RATES[c.type]||0;
totalTax+=c.price*c.qty*taxRate;
subtotal+=c.price*c.qty;
const div=document.createElement('div');div.className='cart-item'+(idx===selectedCartIndex?' selected':'');
div.innerHTML=`<div><strong>${escapeHtml(c.name)}</strong><div class='muted'>${c.qty} × ${fmt(c.price)}${c.discount?` (-${c.discount}%)`:''}</div></div><div><button data-remove='${idx}' class='btn secondary'>Remove</button></div>`;
div.addEventListener('click',()=>{selectedCartIndex=idx;renderCart();});
div.querySelector('button').addEventListener('click',(e)=>{e.stopPropagation();removeFromCart(idx)});
cartList.appendChild(div);
});
let total=subtotal+totalTax;
if(employeeDiscountActive) total*=0.7;
subtotalEl.textContent=fmt(subtotal);
taxEl.textContent=fmt(totalTax);
totalEl.textContent=fmt(total);
save('pos_cart',cart);
}

function addToCart(productId,qty=1){const p=products.find(x=>x.id===productId);if(!p)return alert('Product not found');if(p.qty<qty)return alert('Not enough stock');const existing=cart.find(c=>c.id===p.id);if(existing){existing.qty+=qty;}else{cart.push({id:p.id,name:p.name,price:p.price,qty,type:p.type});}p.qty-=qty;save('pos_products',products);renderProducts(search.value);renderCart();}
function removeFromCart(idx){const item=cart[idx];const prod=products.find(p=>p.id===item.id);if(prod){prod.qty+=item.qty;}cart.splice(idx,1);save('pos_products',products);renderProducts(search.value);renderCart();}
function clearCart(){cart.forEach(it=>{const p=products.find(x=>x.id===it.id);if(p)p.qty+=it.qty;});cart=[];save('pos_products',products);renderProducts(search.value);renderCart();employeeDiscountActive=false;changeDue.textContent='Change: $0.00';}

function checkout(method='Cash',cashAmount=null){if(cart.length===0)return alert('Cart is empty');let subtotal=cart.reduce((s,i)=>s+i.price*i.qty,0);let tax=cart.reduce((s,i)=>s+i.price*i.qty*TAX_RATES[i.type],0);let total=subtotal+tax;if(employeeDiscountActive)total*=0.7;const tx={id:'t'+Date.now(),items:cart.map(i=>({name:i.name,qty:i.qty,price:i.price})),amount:total,date:new Date().toLocaleString(),method};sales.unshift(tx);save('pos_sales',sales);cart=[];save('pos_cart',cart);renderCart();
if(method==='Cash'&&cashAmount!==null){const change=cashAmount-total;changeDue.textContent='Change: '+fmt(change>=0?change:0);}else{changeDue.textContent='Change: $0.00';}
alert('Payment recorded: '+fmt(total));employeeDiscountActive=false;}

payCash.addEventListener('click',()=>{checkout('Cash',parseFloat(cashReceived.value));});

function applyDiscount(percent){if(selectedCartIndex===null)return alert('Select a cart item first');cart[selectedCartIndex].price=cart[selectedCartIndex].price*(1-percent/100);cart[selectedCartIndex].discount=percent;renderCart();}
document.getElementById('discount10').addEventListener('click',()=>applyDiscount(10));
document.getElementById('discount20').addEventListener('click',()=>applyDiscount(20));
document.getElementById('employeeDiscount').addEventListener('click',()=>{employeeDiscountActive=true;renderCart();});

function escapeHtml(s){return String(s).replace(/[&<>\"']/g,function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];});}

// Self-Checkout toggle
const toggleBtn=document.getElementById('toggleSelfCheckout');
toggleBtn.addEventListener('click',()=>{
selfCheckoutMode=!selfCheckoutMode;
document.getElementById('cartCard').classList.toggle('self-checkout',selfCheckoutMode);
cashInputDiv.style.display=selfCheckoutMode?'none':'flex';
});
</script>
</body>
</html>
