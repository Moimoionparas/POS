<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>POS Web App — HTML</title>
  <style>
    :root{--bg:#f7fafc;--card:#ffffff;--accent:#2563eb;--muted:#6b7280}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0;background:var(--bg);color:#111}
    .container{max-width:1100px;margin:28px auto;padding:16px;display:grid;grid-template-columns:1fr 420px;gap:20px}
    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
    h1{margin:0;font-size:20px}
    .products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .product{border:1px solid #e6edf6;border-radius:8px;padding:10px;display:flex;flex-direction:column}
    .product .meta{font-size:13px;color:var(--muted)}
    .product button{margin-top:10px;padding:8px;border-radius:6px;background:var(--accent);color:#fff;border:0;cursor:pointer}
    .cart-list{max-height:420px;overflow:auto}
    .cart-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #eee}
    .muted{color:var(--muted)}
    .btn{display:inline-block;padding:8px 12px;border-radius:6px;border:0;background:#111;color:#fff;cursor:pointer}
    .btn.secondary{background:#f3f4f6;color:#111}
    .transactions{margin-top:14px}
    footer{max-width:1100px;margin:18px auto;text-align:center;color:var(--muted);font-size:13px}
    @media (max-width:900px){.container{grid-template-columns:1fr;}.header{flex-direction:column;align-items:flex-start;gap:8px}}
  </style>
</head>
<body>
  <div class="header container">
    <div>
      <h1>POS Web App (HTML)</h1>
      <div class="muted">Simple, single-file point-of-sale — works offline in your browser</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="exportProducts" class="btn secondary">Export Products CSV</button>
      <button id="exportSales" class="btn secondary">Export Sales CSV</button>
    </div>
  </div>

  <main class="container">
    <!-- Left: Products and Transactions -->
    <section>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <strong>Products</strong>
          <input id="search" placeholder="Search products or SKU" style="padding:8px;border-radius:6px;border:1px solid #e5e7eb;width:280px" />
        </div>

        <div id="products" class="products"></div>
      </div>

      <div id="transactions" class="card transactions" style="margin-top:12px">
        <strong>Transactions</strong>
        <div id="txList" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- Right: Cart -->
    <aside>
      <div class="card">
        <strong>Cart</strong>
        <div id="cartList" class="cart-list" style="margin-top:10px"></div>

        <div style="margin-top:12px;border-top:1px dashed #eee;padding-top:10px">
          <div style="display:flex;justify-content:space-between"><div class="muted">Subtotal</div><div id="subtotal">$0.00</div></div>
          <div style="display:flex;justify-content:space-between"><div class="muted">Tax (10%)</div><div id="tax">$0.00</div></div>
          <div style="display:flex;justify-content:space-between;font-weight:600;margin-top:6px"><div>Total</div><div id="total">$0.00</div></div>

          <div style="margin-top:12px;display:flex;gap:8px">
            <button id="payCash" class="btn" style="flex:1">Pay Cash</button>
            <button id="payCard" class="btn" style="flex:1">Pay Card</button>
          </div>

          <button id="clearCart" class="btn secondary" style="width:100%;margin-top:8px">Clear Cart</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <strong>Quick Add</strong>
        <div style="margin-top:8px;display:flex;gap:8px">
          <input id="newName" placeholder="Name" style="flex:1;padding:8px;border-radius:6px;border:1px solid #e5e7eb" />
          <input id="newPrice" placeholder="Price" type="number" style="width:90px;padding:8px;border-radius:6px;border:1px solid #e5e7eb" />
          <button id="addProduct" class="btn secondary">Add</button>
        </div>
      </div>
    </aside>
  </main>

  <footer>Works offline. Data stored locally in your browser (localStorage). Export CSV to back up.</footer>

  <script>
    // --- Data & persistence ---
    const defaultProducts = [
      {id:'p1',sku:'1001',name:'Coffee',price:3,qty:50},
      {id:'p2',sku:'1002',name:'Sandwich',price:5,qty:30},
      {id:'p3',sku:'1003',name:'Cake',price:4,qty:20},
      {id:'p4',sku:'1004',name:'Juice',price:2,qty:60}
    ];

    let products = load('pos_products') || defaultProducts;
    let cart = load('pos_cart') || [];
    let sales = load('pos_sales') || [];
    const TAX_RATE = parseFloat(load('pos_tax')) || 0.10;

    // --- Elements ---
    const productsEl = document.getElementById('products');
    const cartList = document.getElementById('cartList');
    const subtotalEl = document.getElementById('subtotal');
    const taxEl = document.getElementById('tax');
    const totalEl = document.getElementById('total');
    const txList = document.getElementById('txList');
    const search = document.getElementById('search');

    // --- Helpers ---
    function save(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
    function load(key){ try { return JSON.parse(localStorage.getItem(key)); } catch(e){return null} }
    function fmt(n){ return '$' + Number(n).toFixed(2); }

    // --- Render ---
    function renderProducts(filter=''){
      productsEl.innerHTML = '';
      const q = filter.trim().toLowerCase();
      const list = products.filter(p => !q || p.name.toLowerCase().includes(q) || p.sku.toLowerCase().includes(q));
      list.forEach(p=>{
        const el = document.createElement('div'); el.className='product';
        el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><strong>${escapeHtml(p.name)}</strong><div class='meta'>SKU ${p.sku} • ${p.qty} in stock</div></div><div style='text-align:right'><div style='font-weight:600;margin-bottom:6px'>${fmt(p.price)}</div><button data-id='${p.id}'>Add</button></div></div>`;
        const btn = el.querySelector('button'); btn.addEventListener('click', ()=>{ addToCart(p.id,1) });
        productsEl.appendChild(el);
      });
    }

    function renderCart(){
      cartList.innerHTML = '';
      let subtotal = 0;
      cart.forEach((c, idx)=>{
        subtotal += c.price * c.qty;
        const div = document.createElement('div'); div.className='cart-item';
        div.innerHTML = `<div><strong>${escapeHtml(c.name)}</strong><div class='muted'>${c.qty} × ${fmt(c.price)}</div></div><div><button data-remove='${idx}' class='btn secondary'>Remove</button></div>`;
        div.querySelector('button').addEventListener('click', ()=>{ removeFromCart(idx) });
        cartList.appendChild(div);
      });
      const tax = subtotal * TAX_RATE;
      const total = subtotal + tax;
      subtotalEl.textContent = fmt(subtotal);
      taxEl.textContent = fmt(tax);
      totalEl.textContent = fmt(total);
      save('pos_cart', cart);
    }

    function renderTransactions(){
      txList.innerHTML = '';
      if(sales.length===0){ txList.innerHTML = '<div class="muted" style="margin-top:8px">No transactions yet</div>'; return }
      sales.forEach(s=>{
        const d = document.createElement('div'); d.style.padding='8px 0'; d.style.borderBottom='1px solid #f1f5f9';
        d.innerHTML = `<div style='font-weight:600'>${fmt(s.amount)}</div><div class='muted'>${s.date}</div><div class='muted'>${escapeHtml(s.items.map(i=>i.name).join(', '))}</div>`;
        txList.appendChild(d);
      });
    }

    // --- Cart actions ---
    function addToCart(productId, qty=1){
      const p = products.find(x=>x.id===productId);
      if(!p) return alert('Product not found');
      if(p.qty < qty) return alert('Not enough stock');
      const existing = cart.find(c=>c.id===p.id);
      if(existing){ existing.qty += qty; } else { cart.push({id:p.id,name:p.name,price:p.price,qty}); }
      p.qty -= qty;
      save('pos_products', products);
      renderProducts(search.value);
      renderCart();
    }

    function removeFromCart(index){
      const item = cart[index];
      const prod = products.find(p=>p.id===item.id);
      if(prod){ prod.qty += item.qty; }
      cart.splice(index,1);
      save('pos_products', products);
      renderProducts(search.value);
      renderCart();
    }

    function clearCart(){
      // return stock
      cart.forEach(it=>{ const p = products.find(x=>x.id===it.id); if(p) p.qty += it.qty; });
      cart = [];
      save('pos_products', products);
      renderProducts(search.value);
      renderCart();
    }

    function checkout(method='Cash'){
      if(cart.length===0) return alert('Cart is empty');
      const subtotal = cart.reduce((s,i)=>s + i.price * i.qty,0);
      const tax = subtotal * TAX_RATE;
      const amount = subtotal + tax;
      const tx = { id: 't'+Date.now(), items: cart.map(i=>({name:i.name,qty:i.qty,price:i.price})), amount, date: new Date().toLocaleString(), method };
      sales.unshift(tx);
      save('pos_sales', sales);
      cart = [];
      save('pos_cart', cart);
      renderTransactions();
      renderCart();
      alert('Payment recorded: ' + fmt(amount));
    }

    // --- Utilities ---
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; }); }

    function exportCSV(name, rows){
      if(!rows || rows.length===0) return alert('Nothing to export');
      const keys = Object.keys(rows[0]);
      const csv = [keys.join(',')].concat(rows.map(r=>keys.map(k=>`"${String(r[k]).replace(/"/g,'""')}"`).join(','))).join('\n');
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = name + '.csv'; a.click(); URL.revokeObjectURL(url);
    }

    // --- Events ---
    document.getElementById('payCash').addEventListener('click', ()=>checkout('Cash'));
    document.getElementById('payCard').addEventListener('click', ()=>checkout('Card'));
    document.getElementById('clearCart').addEventListener('click', clearCart);
    document.getElementById('addProduct').addEventListener('click', ()=>{
      const name = document.getElementById('newName').value.trim();
      const price = parseFloat(document.getElementById('newPrice').value);
      if(!name || isNaN(price)) return alert('Enter name and price');
      const id = 'p' + Date.now();
      const sku = String(1000 + Math.floor(Math.random()*9000));
      const prod = {id,sku,name,price,qty:9999};
      products.unshift(prod);
      save('pos_products', products);
      renderProducts(search.value);
      document.getElementById('newName').value=''; document.getElementById('newPrice').value='';
    });

    document.getElementById('exportProducts').addEventListener('click', ()=>{
      exportCSV('products', products.map(p=>({id:p.id,sku:p.sku,name:p.name,price:p.price,qty:p.qty})))
    });
    document.getElementById('exportSales').addEventListener('click', ()=>{ exportCSV('sales', sales.map(s=>({id:s.id,amount:s.amount,date:s.date,items:s.items.map(i=>i.name).join('; ')}))) });

    search.addEventListener('input', ()=>renderProducts(search.value));

    // initial render
    renderProducts('');
    renderCart();
    renderTransactions();
  </script>
</body>
</html>